# 机会盘点设置模块 (Opportunity Count Settings Module)

本模块提供了一个管理界面，用于配置“机会盘点”——即由特定仓库活动或条件触发的自动库存盘点任务。

## 核心功能

### 1. 规则列表管理（左侧面板）
*   **概览**：显示所有已配置的规则，按执行优先级排序。
*   **快捷操作**：
    *   **状态切换**：直接使用列表项中的开关（Switch）激活或停用规则。
    *   **优先级调整**：使用上/下按钮重新排序规则。
*   **视觉反馈**：
    *   **激活规则**：以完全不透明度和标准文本颜色显示。
    *   **禁用规则**：以降低的不透明度（变暗）和柔和的文本颜色显示，以便在视觉上与激活规则区分开。
    *   **指示器**：图标显示每个规则启用的触发器（空库存、阈值、异常）。

### 2. 规则配置（右侧面板）
详情面板允许创建和编辑规则，包含以下部分：

#### A. 初始化与校验
*   **默认模板**：新规则使用特定默认值初始化：
    *   **触发器**：空库存触发（Empty Trigger - 已启用）
    *   **任务**：拣货移动（Pick Movement）
    *   **库位类型**：库位（Location）、拣货（Pick）
    *   **盘点方法**：验证数量（Verify Quantity）
    *   **选项**：避免重复（已勾选）、紧急（未勾选）、允许跳过（未勾选）
*   **保存校验**：如果满足以下条件，系统将阻止保存：
    *   规则名称为空。
    *   未启用任何触发规则。
    *   触发任务列表为空。
    *   库位类型列表为空。

#### B. 配置区块
1.  **基本信息 (Basic Info)**：
    *   规则名称（必填）
    *   全局状态（激活/禁用）
    *   客户限制（多选）

2.  **适用范围 (Scope)**：
    *   **触发任务**：启动检查的仓库任务（例如：拣货移动）。
    *   **库位类型**：需要监控的特定库位类别。
    *   **商品 ABC 分类**：按商品分类进行过滤。

3.  **触发规则 (Trigger Rules)**（必须至少激活一项）：
    *   **空库存触发 (Empty Trigger)**：当库存降至 0 时触发。
    *   **阈值触发 (Threshold Trigger)**：当库存降至定义的阈值以下时触发。
    *   **异常触发 (Exception Trigger)**：在特定的操作员报告（缺货、损坏等）时触发。

4.  **任务选项 (Task Options)**：
    *   **盘点行为 (Count Behavior)**：
        *   *智能选择 (Smart Select)*：系统根据预期数量决定。
        *   *验证数量 (Verify Quantity)*：操作员确认数量/单位（默认）。
        *   *盲盘 (Blind Count)*：操作员必须在没有提示的情况下输入数量。
    *   **默认指派人**：分配给盘点任务的用户或角色。
    *   **高级标志**：强制盘点 (Force Count)、允许跳过 (Allow Skip)、避免重复 (Avoid Duplicates)。

## 技术组件
*   **`RuleListPanel`**：处理列表视图、选择逻辑和直接状态切换。
*   **`RuleDetailPanel`**：处理表单逻辑、校验（`handleSave`）和规则属性的深度编辑。
*   **`MultiTagSelect`**：用于处理基于数组的选择（客户、任务等）的自定义组件。
*   **状态管理**：父组件 `page.tsx` 管理 `rules` 状态，处理 CRUD 操作和状态更新。

---
*最后更新：2026年2月*
